---
layout: post
categories: project
title: 데이터마이닝 프로젝트
date:   2022-06-16
excerpt: "인구 데이터 기반 소득 예측경진대회"
tag:
- Python
- ML
comments: false
toc: true
---




# 인구 데이터 기반 소득 예측경진대회 <a class="anchor" id="chapter1"></a>  





* 다양한 인구 데이터 바탕으로 소득이 5만달러 이하인지 초과인지 분류하는 대회.  

* 분류 해야할 클래스는 5만달러 이하인지 초과인지 수입(target)을 총 두가지로 분류하는 대회.  



대회 링크: <https://dacon.io/competitions/official/235892/overview/description>  



다양한 공모전 중 머신러닝 관련 공모전에 참여하고 싶었고, Basic 공모전이라 모델링까지 내가 해볼 수 있을 것 같아 이 공모전을 선택하였다.  

또, 소득을 예측하기 위해 필요한 변수들 또한 한글 데이터로 어렵지 않게 구성되어있었으며, 어떠한 변수들이 소득에 영향을 주는 지 궁금하였다.  



### 목차



* [인구데이터기반소득예측경진대회](#chapter1)

* [데이터 전처리](#chapter2)  

    * [데이터 가져오기](#section_2_1)  

    * [결측치](#section_2_2)  

* [EDA](#chapter3)  

    * [상관관계 분석](#section_3_1)  

        * [범주형 상관관계 분석](#section_3_1_1)  

        * [수치형 상관관계 분석](#section_3_1_2)  

        * [필요없는 변수 제거](#section_3_1_3)  

    * [수치형 변수](#section_3_2)  

        * [age](#section_3_2_1)  

        * [education.num](#section_3_2_2)  

        * [capital.gain](#section_3_2_3)  

        * [capital.loss](#section_3_2_4)  

        * [hours.per.week](#section_3_2_5)  

        * [sex](#section_3_2_6)  

    * [범주형 변수](#section_3_3)  

        * [변수 고유값 확인](section_3_3_1)  

        * [workclass](#section_3_3_2)  

        * [marital.status](#section_3_3_3)  

        * [occupation](#section_3_3_4)  

        * [relationship](#section_3_3_5)

* [모델링](#chapter4)  

    * [원핫인코딩](#section_4_1)  

    * [pycaret](#section_4_2)   

    * [submission](#section_4_3)  

* [결론](#chapter5)  

    * [summary](#section_5_1)  

    * [활용가능](#section_5_2)  

    * [한계](#section_5_3)  

    * [향후계획](#section_5_4)  


# 기본설정


```

id : 샘플 아이디

age : 나이

workclass : 일 유형

fnlwgt : CPS(Current Population Survey) 가중치

education : 교육수준

education.num : 교육수준 번호

marital.status : 결혼 상태

occupation : 직업

relationship : 가족관계

race : 인종

sex : 성별

capital.gain : 자본 이익

capital.loss : 자본 손실

hours.per.week : 주당 근무시간

native.country : 본 국적

target : 소득

````



```python
from google.colab import drive
drive.mount('/content/drive')
```

<pre>
Mounted at /content/drive
</pre>
먼저 pycaret과 markupsafe을 설치 후 런타임 재시작을 해야 pycaret이 돌아감



```python
#!pip install pycaret
```

```python
#!pip install markupsafe==2.0.1
```


```python
import matplotlib.pyplot as plt
from pandas.plotting import scatter_matrix
import seaborn as sns
import platform
# 그래프 폰트 설정
# Window
if platform.system() == 'Windows':
    plt.rc('font', family='Malgun Gothic')
elif platform.system() == 'Darwin': # Mac
    plt.rc('font', family='AppleGothic')
else: #linux
    plt.rc('font', family='NanumGothic')

# 그래프에 마이너스 표시가 되도록 변경
plt.rcParams['axes.unicode_minus'] = False

# 파이썬 ≥3.5 필수
import sys
assert sys.version_info >= (3, 5)

# 사이킷런 ≥0.20 필수
# 여러가지 머신러닝 모델을 가지고 있는 라이브러리 *가장 많이 사용* 
import sklearn
# 공통 모듈 임포트
import numpy as np
import os
import pandas as pd
from sklearn.model_selection import train_test_split 

# 깔끔한 그래프 출력을 위해
plt.rcParams['font.family'] = 'NanumGothic'
%matplotlib inline
import matplotlib as mpl
import matplotlib.pyplot as plt
mpl.rc('axes', labelsize=14)
mpl.rc('xtick', labelsize=12)
mpl.rc('ytick', labelsize=12)
```

# 데이터 전처리 <a class="anchor" id="chapter2"></a>


## 데이터 가져오기 <a class="anchor" id="section_2_1"></a>



```python
cd '/content/drive/MyDrive/소득예측'
```

<pre>
/content/drive/MyDrive/소득예측
</pre>

```python
#data불러오기
train = pd.read_csv('train.csv')
test = pd.read_csv('test.csv')
submission = pd.read_csv('sample_submission.csv')
```


```python
# 데이터 크기 확인
print(train.shape, test.shape)
```

<pre>
(17480, 16) (15081, 15)
</pre>

```python
# education의 값을 수치화 시킨 값들이 education.num 변수와 일치한다는 사실을 확인하여 education 변수를 제거해주었다.
del train['education']
del test['education']
```

## 결측치 <a class="anchor" id="section_2_2"></a>



```python
###train결측값 확인
train.isnull().sum()
# workclass, occupation, native.country 에 결측값이 존재한다.
```

<pre>
id                   0
age                  0
workclass         1836
fnlwgt               0
education.num        0
marital.status       0
occupation        1843
relationship         0
race                 0
sex                  0
capital.gain         0
capital.loss         0
hours.per.week       0
native.country     583
target               0
dtype: int64
</pre>

```python
# train[train.isna().sum(axis=1) > 0]
```


```python
# train 데이터 타입 확인
train.info()
```

<pre>
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 17480 entries, 0 to 17479
Data columns (total 15 columns):
 #   Column          Non-Null Count  Dtype 
---  ------          --------------  ----- 
 0   id              17480 non-null  int64 
 1   age             17480 non-null  int64 
 2   workclass       15644 non-null  object
 3   fnlwgt          17480 non-null  int64 
 4   education.num   17480 non-null  int64 
 5   marital.status  17480 non-null  object
 6   occupation      15637 non-null  object
 7   relationship    17480 non-null  object
 8   race            17480 non-null  object
 9   sex             17480 non-null  object
 10  capital.gain    17480 non-null  int64 
 11  capital.loss    17480 non-null  int64 
 12  hours.per.week  17480 non-null  int64 
 13  native.country  16897 non-null  object
 14  target          17480 non-null  int64 
dtypes: int64(8), object(7)
memory usage: 2.0+ MB
</pre>

```python
# 모두 데이터 값이 범주형이고 결측치들에 대해서 어떤 특별한 패턴은 보이지 않으므로 범주형 데이터에 대해서는 행을 삭제해주었다.
train = train.dropna(axis=0)
```

# EDA <a class="anchor" id="chapter3"></a>


## 상관관계 분석 <a class="anchor" id="section_3_1"></a>


**수치형 자료**

```

'id','age', 'fnlwgt', 'education.num','capital.gain', 'capital.loss', 'hours.per.week', 'target'

```

**범주형 자료**

```

'workclass','marital.status','occupation','relationship','race','sex','native.country'

```

### 범주형 상관관계 분석 <a class="anchor" id="section_3_1_1"></a>



```python
# 시각화를 위해 train 데이터를 copy해준 후 label_encoder를 진행한다. 
train_label_encoder = train.copy()
train_label_encoder
```

<pre>
          id  age     workclass  fnlwgt  education.num      marital.status  \
0          0   32       Private  309513             12  Married-civ-spouse   
1          1   33       Private  205469             10  Married-civ-spouse   
2          2   46       Private  149949             10  Married-civ-spouse   
3          3   23       Private  193090             13       Never-married   
4          4   55       Private   60193              9            Divorced   
...      ...  ...           ...     ...            ...                 ...   
15076  15076   35       Private  337286             14       Never-married   
15077  15077   36       Private  182074             10            Divorced   
15078  15078   50  Self-emp-inc  175070             15  Married-civ-spouse   
15079  15079   39       Private  202937             10            Divorced   
15080  15080   33       Private   96245             12  Married-civ-spouse   

            occupation   relationship                race     sex  \
0         Craft-repair        Husband               White    Male   
1      Exec-managerial        Husband               White    Male   
2         Craft-repair        Husband               White    Male   
3         Adm-clerical      Own-child               White  Female   
4         Adm-clerical  Not-in-family               White  Female   
...                ...            ...                 ...     ...   
15076  Exec-managerial  Not-in-family  Asian-Pac-Islander    Male   
15077     Adm-clerical  Not-in-family               White    Male   
15078   Prof-specialty        Husband               White    Male   
15079     Tech-support  Not-in-family               White  Female   
15080   Prof-specialty        Husband               White    Male   

       capital.gain  capital.loss  hours.per.week native.country  target  
0                 0             0              40  United-States       0  
1                 0             0              40  United-States       1  
2                 0             0              40  United-States       0  
3                 0             0              30  United-States       0  
4                 0             0              40  United-States       0  
...             ...           ...             ...            ...     ...  
15076             0             0              40  United-States       0  
15077             0             0              45  United-States       0  
15078             0             0              45  United-States       1  
15079             0             0              40         Poland       0  
15080             0             0              50  United-States       0  

[15081 rows x 15 columns]
</pre>
label encoder



```python
# 상관관계 분석을 하기 위해 범주형 변수들을 수치형으로 바꿔줘야 하는데 one-hot encoding을 사용하면 변수들이 너무 많아져 시각화가 어려워진다.
# 또, label encoding을 사용하면 분석 결과가 안좋아질 수 있으므로 복제하여 train_label_encoder 만든 뒤 상관관계분석을한다.
from sklearn.preprocessing import LabelEncoder

le = LabelEncoder()
train_label_encoder['workclass'] = le.fit_transform(train['workclass'])
train_label_encoder['marital.status'] = le.fit_transform(train['marital.status'])
train_label_encoder['occupation'] = le.fit_transform(train['occupation'])
train_label_encoder['relationship'] = le.fit_transform(train['relationship'])
train_label_encoder['race'] = le.fit_transform(train['race'])
train_label_encoder['sex'] = le.fit_transform(train['sex'])
train_label_encoder['native.country'] = le.fit_transform(train['native.country'])
```


```python
# 값들이 잘 바뀐 것을 확인할 수 있다.
train_label_encoder.head()
```

<pre>
   id  age  workclass  fnlwgt  education.num  marital.status  occupation  \
0   0   32          2  309513             12               2           2   
1   1   33          2  205469             10               2           3   
2   2   46          2  149949             10               2           2   
3   3   23          2  193090             13               4           0   
4   4   55          2   60193              9               0           0   

   relationship  race  sex  capital.gain  capital.loss  hours.per.week  \
0             0     4    1             0             0              40   
1             0     4    1             0             0              40   
2             0     4    1             0             0              40   
3             3     4    0             0             0              30   
4             1     4    0             0             0              40   

   native.country  target  
0              38       0  
1              38       1  
2              38       0  
3              38       0  
4              38       0  
</pre>

```python
# target값을 기준으로 상관관계 분석을 해준다.
corr_matrix = train_label_encoder.corr()
corr_matrix["target"].sort_values(ascending=False)
```

<pre>
target            1.000000
education.num     0.341073
age               0.242283
hours.per.week    0.237383
capital.gain      0.221003
sex               0.216109
capital.loss      0.153660
race              0.079966
occupation        0.047896
native.country    0.030942
workclass         0.024025
id               -0.003228
fnlwgt           -0.005028
marital.status   -0.194685
relationship     -0.249029
Name: target, dtype: float64
</pre>

```python
# heatmap을 사용하여 상관관계분석 결과를 시각화 해준다.
sns.heatmap(corr_matrix, cmap='Blues',annot=True)
sns.set(rc = {'figure.figsize':(20,20)})
```

<pre>
<img src = "https://raw.githubusercontent.com/yangjunghyun/yangjunghyun.github.io/master/projects/images/%EC%9D%B8%EA%B5%AC%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B8%B0%EB%B0%98%EC%86%8C%EB%93%9D%EC%98%88%EC%B8%A1%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C__30_0.png" />
</pre>

### 수치형 상관관계 분석 <a class="anchor" id="section_3_1_2"></a>


변수가 너무 많으면 시각화를 해도 결과를 한눈에 보기에 어렵기 때문에 범주형 변수들은 따로 copy데이터를 만들어 label_encoder를 진행한 뒤 시각화하였고, 수치형 변수도 따로 상관관계 분석 및 시각화를 해주었다.



```python
corr_matrix = train.corr()
corr_matrix["target"].sort_values(ascending=False)
```

<pre>
target            1.000000
education.num     0.341073
age               0.242283
hours.per.week    0.237383
capital.gain      0.221003
capital.loss      0.153660
id               -0.003228
fnlwgt           -0.005028
Name: target, dtype: float64
</pre>

```python
sns.heatmap(corr_matrix, cmap='Blues',annot=True)
sns.set(rc = {'figure.figsize':(10,10)})
```

<pre>
<img src = "https://raw.githubusercontent.com/yangjunghyun/yangjunghyun.github.io/master/projects/images/%EC%9D%B8%EA%B5%AC%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B8%B0%EB%B0%98%EC%86%8C%EB%93%9D%EC%98%88%EC%B8%A1%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C__34_0.png" />
</pre>

상관관계 분석 결과 target과 관계성이 높은 변수는 education.num, hours.per.week, age

관계성이 낮은 변수는 fnlwgt, race, native.country임을 알 수 있다.


### 필요없는 변수 제거 <a class="anchor" id="section_3_1_3"></a>



```python
plt.figure(figsize=(30,16),dpi=50)
sns.set_style("whitegrid")

# income 별 fnlwgt 분포
plt.subplot(311)
fnlwgt_0 = train.loc[train['target'] == 0, 'fnlwgt']
fnlwgt_1 = train.loc[train['target'] == 1, 'fnlwgt']
sns.set(font_scale = 2)
sb = sns.distplot(fnlwgt_0, hist = False, kde_kws={"color": "skyblue", "lw": 4})
pn = sns.distplot(fnlwgt_1, hist = False, kde_kws={"color": "pink", "lw": 4})
sb.set_xlabel("fnlwgt", fontsize = 20)
pn.set_ylabel("distribution", fontsize = 20)
plt.legend(labels=["<= 50k",">50k"])

sns.set_style("whitegrid")
# income 별 race 분포
plt.subplot(312)
race_0 = train_label_encoder.loc[train['target'] == 0, 'race']
race_1 = train_label_encoder.loc[train['target'] == 1, 'race']
sns.set(font_scale = 2)
sb = sns.distplot(race_0, hist = False, kde_kws={"color": "skyblue", "lw": 4})
pn = sns.distplot(race_1, hist = False, kde_kws={"color": "pink", "lw": 4})
sb.set_xlabel("race", fontsize = 20)
pn.set_ylabel("distribution", fontsize = 20)

sns.set_style("whitegrid")
# income 별 native.country 분포
plt.subplot(313)
native_country_0 = train_label_encoder.loc[train['target'] == 0, 'native.country']
native_country_1 = train_label_encoder.loc[train['target'] == 1, 'native.country']
sns.set(font_scale = 2)
sb = sns.distplot(native_country_0, hist = False, kde_kws={"color": "skyblue", "lw": 4})
pn = sns.distplot(native_country_1, hist = False, kde_kws={"color": "pink", "lw": 4})
sb.set_xlabel("native.country", fontsize = 20)
pn.set_ylabel("distribution", fontsize = 20)
```

<pre>
<img src = "https://raw.githubusercontent.com/yangjunghyun/yangjunghyun.github.io/master/projects/images/%EC%9D%B8%EA%B5%AC%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B8%B0%EB%B0%98%EC%86%8C%EB%93%9D%EC%98%88%EC%B8%A1%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C__37_2.png" />
</pre>

```python
# 모델링을 위해 one-hot encoding 진행할 때 native.country 변수가 문제가 되어 해결방법을 찾던 중 상관관계성이 낮고, target이 0인 값과 target이 1인 값을 그래프로 표현하였을때 차이가 없어 지워도 되겠다고 판단하였다.
del train['fnlwgt']
del train['race']
del train['native.country']

del test['fnlwgt']
del test['race']
del test['native.country']
```


```python
# 변수들이 잘 지워진 것을 확인
train
```

<pre>
          id  age     workclass  education.num      marital.status  \
0          0   32       Private             12  Married-civ-spouse   
1          1   33       Private             10  Married-civ-spouse   
2          2   46       Private             10  Married-civ-spouse   
3          3   23       Private             13       Never-married   
4          4   55       Private              9            Divorced   
...      ...  ...           ...            ...                 ...   
15076  15076   35       Private             14       Never-married   
15077  15077   36       Private             10            Divorced   
15078  15078   50  Self-emp-inc             15  Married-civ-spouse   
15079  15079   39       Private             10            Divorced   
15080  15080   33       Private             12  Married-civ-spouse   

            occupation   relationship     sex  capital.gain  capital.loss  \
0         Craft-repair        Husband    Male             0             0   
1      Exec-managerial        Husband    Male             0             0   
2         Craft-repair        Husband    Male             0             0   
3         Adm-clerical      Own-child  Female             0             0   
4         Adm-clerical  Not-in-family  Female             0             0   
...                ...            ...     ...           ...           ...   
15076  Exec-managerial  Not-in-family    Male             0             0   
15077     Adm-clerical  Not-in-family    Male             0             0   
15078   Prof-specialty        Husband    Male             0             0   
15079     Tech-support  Not-in-family  Female             0             0   
15080   Prof-specialty        Husband    Male             0             0   

       hours.per.week  target  
0                  40       0  
1                  40       1  
2                  40       0  
3                  30       0  
4                  40       0  
...               ...     ...  
15076              40       0  
15077              45       0  
15078              45       1  
15079              40       0  
15080              50       0  

[15081 rows x 12 columns]
</pre>
## 수치형 변수 <a class="anchor" id="section_3_2"></a> `age`, `education.num`, `capital.gain`, `capital.loss`, `hours.per.week`, `sex`



```python
# train 데이터 중 target값이 0인 데이터만 추출하여 새로운 데이터로 만들어준다.
target_0 = train.query('target==0').copy()
target_0
```

<pre>
          id  age workclass  education.num      marital.status  \
0          0   32   Private             12  Married-civ-spouse   
2          2   46   Private             10  Married-civ-spouse   
3          3   23   Private             13       Never-married   
4          4   55   Private              9            Divorced   
5          5   33   Private             13  Married-civ-spouse   
...      ...  ...       ...            ...                 ...   
15075  15075   18   Private              9       Never-married   
15076  15076   35   Private             14       Never-married   
15077  15077   36   Private             10            Divorced   
15079  15079   39   Private             10            Divorced   
15080  15080   33   Private             12  Married-civ-spouse   

              occupation   relationship     sex  capital.gain  capital.loss  \
0           Craft-repair        Husband    Male             0             0   
2           Craft-repair        Husband    Male             0             0   
3           Adm-clerical      Own-child  Female             0             0   
4           Adm-clerical  Not-in-family  Female             0             0   
5         Prof-specialty        Husband    Male             0             0   
...                  ...            ...     ...           ...           ...   
15075  Machine-op-inspct  Not-in-family    Male             0             0   
15076    Exec-managerial  Not-in-family    Male             0             0   
15077       Adm-clerical  Not-in-family    Male             0             0   
15079       Tech-support  Not-in-family  Female             0             0   
15080     Prof-specialty        Husband    Male             0             0   

       hours.per.week  target  
0                  40       0  
2                  40       0  
3                  30       0  
4                  40       0  
5                  40       0  
...               ...     ...  
15075              37       0  
15076              40       0  
15077              45       0  
15079              40       0  
15080              50       0  

[11308 rows x 12 columns]
</pre>

```python
# train 데이터 중 target값이 1인 데이터만 추출하여 새로운 데이터로 만들어준다.
target_1 = train.query('target==1').copy()
target_1
```

<pre>
          id  age         workclass  education.num      marital.status  \
1          1   33           Private             10  Married-civ-spouse   
6          6   40         State-gov             15  Married-civ-spouse   
13        13   51           Private              7  Married-civ-spouse   
18        18   27           Private             10  Married-civ-spouse   
21        21   58           Private             10  Married-civ-spouse   
...      ...  ...               ...            ...                 ...   
15069  15069   42       Federal-gov             11            Divorced   
15070  15070   41           Private             10  Married-civ-spouse   
15072  15072   61           Private             13            Divorced   
15073  15073   57  Self-emp-not-inc             10  Married-civ-spouse   
15078  15078   50      Self-emp-inc             15  Married-civ-spouse   

             occupation   relationship     sex  capital.gain  capital.loss  \
1       Exec-managerial        Husband    Male             0             0   
6        Prof-specialty        Husband    Male             0             0   
13         Craft-repair        Husband    Male             0             0   
18       Prof-specialty        Husband    Male             0             0   
21                Sales        Husband    Male             0             0   
...                 ...            ...     ...           ...           ...   
15069      Adm-clerical      Unmarried  Female             0             0   
15070      Craft-repair        Husband    Male          7298             0   
15072      Adm-clerical  Not-in-family    Male             0             0   
15073  Transport-moving        Husband    Male             0             0   
15078    Prof-specialty        Husband    Male             0             0   

       hours.per.week  target  
1                  40       1  
6                  38       1  
13                 40       1  
18                 40       1  
21                 45       1  
...               ...     ...  
15069              40       1  
15070              50       1  
15072              40       1  
15073              45       1  
15078              45       1  

[3773 rows x 12 columns]
</pre>
### age <a class="anchor" id="section_3_2_1"></a>


age min = 17

age max = 90



```python
# age 변수의 분포를 target이 1과 0인 값을 비교하여 시각화해준다.
age_0 = target_0['age']
age_1 = target_1['age']

sns.set(font_scale = 2)
plt.figure(figsize=(12,8))
sns.set_style('whitegrid')
ax_0 = sns.distplot(age_0, hist = False, kde_kws={"color": "skyblue", "lw": 3})
ax_1 = sns.distplot(age_1, hist = False, kde_kws={"color": "pink", "lw": 3})
ax_0.set_xlabel("AGE", fontsize = 20)
ax_0.set_ylabel("DIST", fontsize = 20)
plt.legend(labels=["<= 50k","> 50k"])
```

<pre>
<img src = "https://raw.githubusercontent.com/yangjunghyun/yangjunghyun.github.io/master/projects/images/%EC%9D%B8%EA%B5%AC%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B8%B0%EB%B0%98%EC%86%8C%EB%93%9D%EC%98%88%EC%B8%A1%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C__45_2.png" />
</pre>

```python
# ppt 시각화를 위한 코드
# target_0데이터 age변수의 count를 시각화해준다.
sns.set_style("whitegrid") # 그래프의 배경을 whitegrid로 지정해준다.
ax = sns.countplot(x=target_0['age'], data=target_0)
ax.set(xlabel="AGE", ylabel = "COUNT") # xlabel = AGE, ylabel = COUNT로 지정해준다.
plt.xticks(rotation = - 90 )
sns.set(rc = {'figure.figsize':(15,15)})
plt.show()
```

<pre>
<img src = "https://raw.githubusercontent.com/yangjunghyun/yangjunghyun.github.io/master/projects/images/%EC%9D%B8%EA%B5%AC%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B8%B0%EB%B0%98%EC%86%8C%EB%93%9D%EC%98%88%EC%B8%A1%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C__46_0.png" />
</pre>

```python
# target_1데이터 age변수의 count를 시각화해준다.
sns.set_style("whitegrid") # 그래프의 배경을 whitegrid로 지정해준다.
ax = sns.countplot(x=target_1['age'], data=target_1)
ax.set(xlabel="AGE", ylabel = "COUNT") # xlabel = AGE, ylabel = COUNT로 지정해준다.
plt.xticks(rotation = - 90 )
sns.set(rc = {'figure.figsize':(15,15)})
plt.show()
```

<pre>
<img src = "https://raw.githubusercontent.com/yangjunghyun/yangjunghyun.github.io/master/projects/images/%EC%9D%B8%EA%B5%AC%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B8%B0%EB%B0%98%EC%86%8C%EB%93%9D%EC%98%88%EC%B8%A1%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C__47_0.png" />
</pre>

분포가 너무 많아 시각화로 보기 힘들 것 같아 적당한 구간을 나누어 ppt 차트에 값을 입력해주었다.


### education.num <a class="anchor" id="section_3_2_2"></a>



```python
# edcuation.num 변수의 분포를 target이 1과 0인 값을 비교하여 시각화해준다.
education_0 = target_0['education.num']
education_1 = target_1['education.num']

sns.set(font_scale = 2)
plt.figure(figsize=(12,8))
sns.set_style('whitegrid')
ax_0 = sns.distplot(education_0, hist = False, kde_kws={"color": "indigo", "lw": 3})
ax_1 = sns.distplot(education_1, hist = False, kde_kws={"color": "cornflowerblue", "lw": 3})
ax_0.set_xlabel("EDUCATION", fontsize = 20)
ax_0.set_ylabel("DIST", fontsize = 20)
plt.legend(labels=["<= 50k","> 50k"])
```

<pre>
<img src = "https://raw.githubusercontent.com/yangjunghyun/yangjunghyun.github.io/master/projects/images/%EC%9D%B8%EA%B5%AC%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B8%B0%EB%B0%98%EC%86%8C%EB%93%9D%EC%98%88%EC%B8%A1%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C__50_2.png" />
</pre>

```python
# target_0데이터 education.num변수의 count를 시각화해준다.
sns.set_style("whitegrid") # 그래프의 배경을 whitegrid로 지정해준다.
ax = sns.countplot(x=target_0['education.num'], data=target_0)
ax.set(xlabel="EDUCATION", ylabel = "COUNT") # xlabe = EDUCATION, ylabel = COUNT로 지정해준다.
plt.xticks(rotation = - 90 )
sns.set(rc = {'figure.figsize':(10,10)})
plt.show()
```

<pre>
<img src = "https://raw.githubusercontent.com/yangjunghyun/yangjunghyun.github.io/master/projects/images/%EC%9D%B8%EA%B5%AC%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B8%B0%EB%B0%98%EC%86%8C%EB%93%9D%EC%98%88%EC%B8%A1%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C__51_0.png" />
</pre>

```python
# target_1데이터 education.num변수의 count를 시각화해준다.
sns.set_style("whitegrid")
ax = sns.countplot(x=target_1['education.num'], data=target_1)
ax.set(xlabel="EDUCATION", ylabel = "COUNT")
plt.xticks(rotation = - 90 )
sns.set(rc = {'figure.figsize':(10,10)})
plt.show()
```

<pre>
<img src = "https://raw.githubusercontent.com/yangjunghyun/yangjunghyun.github.io/master/projects/images/%EC%9D%B8%EA%B5%AC%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B8%B0%EB%B0%98%EC%86%8C%EB%93%9D%EC%98%88%EC%B8%A1%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C__52_0.png" />
</pre>

### capital.gain <a class="anchor" id="section_3_2_3"></a>



```python
train['capital.gain'].value_counts()
```

<pre>
0        13812
15024      176
7688       136
7298       116
99999       76
         ...  
4687         1
34095        1
1409         1
401          1
1797         1
Name: capital.gain, Length: 107, dtype: int64
</pre>

```python
train['capital.gain']
```

<pre>
0        0
1        0
2        0
3        0
4        0
        ..
15076    0
15077    0
15078    0
15079    0
15080    0
Name: capital.gain, Length: 15081, dtype: int64
</pre>

```python
# fig= plt.rc('axes', labelsize=5)   # x,y축 label 폰트 크기

fig, axes = plt.subplots(1, 2)
fig.set_size_inches(20, 8)

gain1 = train.loc[(train['target'] == 0) & (train['capital.gain'] > 0), 'capital.gain'].value_counts().sort_index()

gain1.plot(kind='bar', ax=axes[0])
plt.xticks(fontsize =10)

gain1 = train.loc[(train['target'] == 1) & (train['capital.gain'] > 0), 'capital.gain'].value_counts().sort_index()
gain1.plot(kind='bar', ax=axes[1])

plt.tight_layout()
plt.show()
```

<pre>
<img src = "https://raw.githubusercontent.com/yangjunghyun/yangjunghyun.github.io/master/projects/images/%EC%9D%B8%EA%B5%AC%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B8%B0%EB%B0%98%EC%86%8C%EB%93%9D%EC%98%88%EC%B8%A1%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C__56_0.png" />
</pre>

```python
fig, axes = plt.subplots(1, 2)
fig.set_size_inches(20, 8)
loss1 = train.loc[(train['target'] == 0) & (train['capital.loss'] > 0), 'capital.loss'].value_counts().sort_index()
loss1.plot(kind='bar', ax=axes[0])

plt.xticks(fontsize =10)

loss1 = train.loc[(train['target'] == 1) & (train['capital.loss'] > 0), 'capital.loss'].value_counts().sort_index()
loss1.plot(kind='bar', ax=axes[1])

plt.tight_layout()
plt.show()
```

<pre>
<img src = "https://raw.githubusercontent.com/yangjunghyun/yangjunghyun.github.io/master/projects/images/%EC%9D%B8%EA%B5%AC%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B8%B0%EB%B0%98%EC%86%8C%EB%93%9D%EC%98%88%EC%B8%A1%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C__57_0.png" />
</pre>

```python
plt.figure(figsize=(12,8))
sns.histplot(x='capital.gain',hue='target',data=train)
```

<pre>
<img src = "https://raw.githubusercontent.com/yangjunghyun/yangjunghyun.github.io/master/projects/images/%EC%9D%B8%EA%B5%AC%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B8%B0%EB%B0%98%EC%86%8C%EB%93%9D%EC%98%88%EC%B8%A1%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C__58_1.png" />
</pre>

### capital.loss <a class="anchor" id="section_3_2_4"></a>



```python
plt.figure(figsize=(12,8))
sns.histplot(x='capital.loss',hue='target',data=train)
```

<pre>
<img src = "https://raw.githubusercontent.com/yangjunghyun/yangjunghyun.github.io/master/projects/images/%EC%9D%B8%EA%B5%AC%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B8%B0%EB%B0%98%EC%86%8C%EB%93%9D%EC%98%88%EC%B8%A1%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C__60_1.png" />
</pre>

capital.gain 변수와 capital.loss 변수를 다양하게 시각화 해보았으나 값들이 무엇을 의미하는지 알 수 없어서 아쉬웠다.


### hours.per.week <a class="anchor" id="section_3_2_5"></a>



```python
# housr.per.week 변수의 분포를 target이 1과 0인 값을 비교하여 시각화해준다.
hours_per_week_0 = target_0['hours.per.week']
hours_per_week_1 = target_1['hours.per.week']

sns.set(font_scale = 2)
plt.figure(figsize=(12,8))
sns.set_style('ticks')
ax_0 = sns.distplot(hours_per_week_0, hist = False, kde_kws={"color": "red", "lw": 3})
ax_1 = sns.distplot(hours_per_week_1, hist = False, kde_kws={"color": "blue", "lw": 3})
ax_0.set_xlabel("HOURS.PER.WEEK", fontsize = 20)
ax_0.set_ylabel("DIST", fontsize = 20)
plt.legend(labels=["<= 50k","> 50k"])
```

<pre>
<img src = "https://raw.githubusercontent.com/yangjunghyun/yangjunghyun.github.io/master/projects/images/%EC%9D%B8%EA%B5%AC%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B8%B0%EB%B0%98%EC%86%8C%EB%93%9D%EC%98%88%EC%B8%A1%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C__63_2.png" />
</pre>

```python
### value의 variance가 너무 크므로 보기 좋은 시각화를 위해 그룹별로 변수를 생성해 분리해준다.
target_0['hours.per.week'].value_counts()
```

<pre>
40    5634
50     721
35     540
45     527
20     495
      ... 
82       1
92       1
94       1
88       1
74       1
Name: hours.per.week, Length: 86, dtype: int64
</pre>

```python
 # if문을 사용하여 시간별로 나눠준다.
 def hours_per_week(a):
    if a <= 10:
        score = '10시간 이하'
    elif a <= 20:
        score = '20시간 이하'
    elif a <= 30:
        score = '30시간 이하'
    elif a <= 40:
        score = '40시간 이하'
    elif a <= 50:
        score = '50시간 이하'
    elif a <= 60:
        score = '60시간 이하'
    elif a <= 70:
        score = '70시간 이하'
    elif a <= 80:
        score = '80시간 이하'                    
    else:
        score = '81시간 이상'
    return score
```


```python
# 그리고 함수를 사용하여 나눠준 값들을 새로운 변수를 생성하여 할당해준다.
target_0["주당근무시간"] = target_0["hours.per.week"].apply(lambda a: hours_per_week(a))
target_1["주당근무시간"] = target_1["hours.per.week"].apply(lambda a: hours_per_week(a))
```


```python
# 값이 잘 바뀌었는지 확인
target_0
```

<pre>
          id  age workclass  education.num      marital.status  \
0          0   32   Private             12  Married-civ-spouse   
2          2   46   Private             10  Married-civ-spouse   
3          3   23   Private             13       Never-married   
4          4   55   Private              9            Divorced   
5          5   33   Private             13  Married-civ-spouse   
...      ...  ...       ...            ...                 ...   
15075  15075   18   Private              9       Never-married   
15076  15076   35   Private             14       Never-married   
15077  15077   36   Private             10            Divorced   
15079  15079   39   Private             10            Divorced   
15080  15080   33   Private             12  Married-civ-spouse   

              occupation   relationship     sex  capital.gain  capital.loss  \
0           Craft-repair        Husband    Male             0             0   
2           Craft-repair        Husband    Male             0             0   
3           Adm-clerical      Own-child  Female             0             0   
4           Adm-clerical  Not-in-family  Female             0             0   
5         Prof-specialty        Husband    Male             0             0   
...                  ...            ...     ...           ...           ...   
15075  Machine-op-inspct  Not-in-family    Male             0             0   
15076    Exec-managerial  Not-in-family    Male             0             0   
15077       Adm-clerical  Not-in-family    Male             0             0   
15079       Tech-support  Not-in-family  Female             0             0   
15080     Prof-specialty        Husband    Male             0             0   

       hours.per.week  target   주당근무시간  
0                  40       0  40시간 이하  
2                  40       0  40시간 이하  
3                  30       0  30시간 이하  
4                  40       0  40시간 이하  
5                  40       0  40시간 이하  
...               ...     ...      ...  
15075              37       0  40시간 이하  
15076              40       0  40시간 이하  
15077              45       0  50시간 이하  
15079              40       0  40시간 이하  
15080              50       0  50시간 이하  

[11308 rows x 13 columns]
</pre>

```python
# target값이 0인 데이터의 분포를 더 쉽게 살펴볼 수 있게되었다.
sns.set_style("whitegrid")
ax = sns.countplot(x=target_0['주당근무시간'], data=target_0)
ax.set(xlabel="HOURS_PER_WEEK", ylabel = "COUNT")
plt.xticks(rotation = - 90 )
sns.set(rc = {'figure.figsize':(10,10)})
# plt.rcParams['font.family'] = 'Malgun Gothic'
plt.rc('font', family='Malgun Gothic')
plt.show()
```

<pre>
<img src = "https://raw.githubusercontent.com/yangjunghyun/yangjunghyun.github.io/master/projects/images/%EC%9D%B8%EA%B5%AC%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B8%B0%EB%B0%98%EC%86%8C%EB%93%9D%EC%98%88%EC%B8%A1%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C__68_1.png" />
</pre>

```python
# target값이 1인 데이터의 분포를 더 쉽게 살펴볼 수 있게되었다.
sns.set_style("whitegrid")
ax = sns.countplot(x=target_1['주당근무시간'], data=target_1)
ax.set(xlabel="HOURS_PER_WEEK", ylabel = "COUNT")
plt.xticks(rotation = - 90 )
sns.set(rc = {'figure.figsize':(10,10)})
plt.rcParams['font.family'] = 'Malgun Gothic'
plt.show()
```

<pre>
<img src = "https://raw.githubusercontent.com/yangjunghyun/yangjunghyun.github.io/master/projects/images/%EC%9D%B8%EA%B5%AC%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B8%B0%EB%B0%98%EC%86%8C%EB%93%9D%EC%98%88%EC%B8%A1%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C__69_1.png" />
</pre>

ppt 시각화를 위해 분포하는 정확한 값들을 뽑아 ppt 차트에 적용하여주었다.



```python
target_0['주당근무시간'].value_counts()
```

<pre>
40시간 이하    6627
50시간 이하    1659
30시간 이하     917
20시간 이하     876
60시간 이하     654
10시간 이하     242
70시간 이하     189
80시간 이하      75
81시간 이상      69
Name: 주당근무시간, dtype: int64
</pre>

```python
target_1['주당근무시간'].value_counts()
```

<pre>
40시간 이하    1716
50시간 이하    1149
60시간 이하     551
70시간 이하     120
30시간 이하      73
20시간 이하      61
80시간 이하      53
81시간 이상      34
10시간 이하      16
Name: 주당근무시간, dtype: int64
</pre>
### sex <a class="anchor" id="section_3_2_6"></a>



```python
# sex 변수는 2개의 값으로 이루어져있으므로 위에서 사용한 label_encoder를 사용하여 수치형으로 그냥 변환해준다.
train['sex'] = le.fit_transform(train['sex'])
test['sex'] = le.fit_transform(test['sex'])
target_0['sex'] = le.fit_transform(target_0['sex'])
target_1['sex'] = le.fit_transform(target_1['sex'])
```


```python
# sex 변수의 분포를 target이 1과 0인 값을 비교하여 시각화해준다.
sex_0 = target_0['sex']
sex_1 = target_1['sex']

sns.set(font_scale = 2)
plt.figure(figsize=(12,8))
sns.set_style('ticks')
ax_0 = sns.distplot(sex_0, hist = False, kde_kws={"color": "red", "lw": 3})
ax_1 = sns.distplot(sex_1, hist = False, kde_kws={"color": "blue", "lw": 3})
ax_0.set_xlabel("SEX", fontsize = 20)
ax_0.set_ylabel("DIST", fontsize = 20)
plt.legend(labels=["<= 50k","> 50k"])
```

<pre>
<img src = "https://raw.githubusercontent.com/yangjunghyun/yangjunghyun.github.io/master/projects/images/%EC%9D%B8%EA%B5%AC%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B8%B0%EB%B0%98%EC%86%8C%EB%93%9D%EC%98%88%EC%B8%A1%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C__75_2.png" />
</pre>

```python
# sns.set_theme(style="whitegrid")
sns.catplot(x="sex", col="target",
                data=train, kind="count",palette="husl")            
```

<pre>
<img src = "https://raw.githubusercontent.com/yangjunghyun/yangjunghyun.github.io/master/projects/images/%EC%9D%B8%EA%B5%AC%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B8%B0%EB%B0%98%EC%86%8C%EB%93%9D%EC%98%88%EC%B8%A1%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C__76_1.png" />
</pre>

```python
target_0['sex'].value_counts()
```

<pre>
1    6972
0    4336
Name: sex, dtype: int64
</pre>

```python
target_1['sex'].value_counts()
```

<pre>
1    3208
0     565
Name: sex, dtype: int64
</pre>
## 범주형 변수 <a class="anchor" id="section_3_3"></a> `workclass`, `marital.status`, `occupation`, `relationship`, ~~`sex`~~


### 변수 고유값 확인 <a class="anchor" id="section_3_3_1"></a>


sex 변수처럼 수치화하여 EDA 해보아도 괜찮을 것 같은 변수를 찾아보기 위해 확인해보았다.



```python
train['workclass'].value_counts()
```

<pre>
Private             11158
Self-emp-not-inc     1230
Local-gov            1027
State-gov             640
Self-emp-inc          552
Federal-gov           468
Without-pay             6
Name: workclass, dtype: int64
</pre>

```python
train['marital.status'].value_counts()
```

<pre>
Married-civ-spouse       7092
Never-married            4814
Divorced                 2086
Separated                 454
Widowed                   424
Married-spouse-absent     199
Married-AF-spouse          12
Name: marital.status, dtype: int64
</pre>

```python
train['occupation'].value_counts()
```

<pre>
Exec-managerial      2039
Craft-repair         2032
Prof-specialty       1983
Adm-clerical         1844
Sales                1763
Other-service        1594
Machine-op-inspct    1004
Transport-moving      760
Handlers-cleaners     675
Farming-fishing       503
Tech-support          459
Protective-serv       345
Priv-house-serv        77
Armed-Forces            3
Name: occupation, dtype: int64
</pre>

```python
train['relationship'].value_counts()
```

<pre>
Husband           6242
Not-in-family     3836
Own-child         2232
Unmarried         1588
Wife               742
Other-relative     441
Name: relationship, dtype: int64
</pre>

```python
train['sex'].value_counts()
```

<pre>
1    10180
0     4901
Name: sex, dtype: int64
</pre>
변수의 분포를 살펴보았지만 sex변수를 제외하고는 범주형으로 시각화를 하는 것이 더 좋겠다고 판단하였다.


### workclass <a class="anchor" id="section_3_3_2"></a>


ppt 시각화를 위한 코드이다. 더 좋은 시각화를 위해 ppt내의 파이차트를 사용하였다.



```python
train.groupby('workclass')['target'].value_counts()
```

<pre>
workclass         target
Federal-gov       0          291
                  1          177
Local-gov         0          718
                  1          309
Private           0         8713
                  1         2445
Self-emp-inc      1          301
                  0          251
Self-emp-not-inc  0          867
                  1          363
State-gov         0          462
                  1          178
Without-pay       0            6
Name: target, dtype: int64
</pre>

```python
sns.set_style("whitegrid")
sns.countplot(x=train['workclass'], hue = train['target'],palette = "muted")
plt.xticks(rotation = - 90 )
sns.set(rc = {'figure.figsize':(7,7)})
```

<pre>
<img src = "https://raw.githubusercontent.com/yangjunghyun/yangjunghyun.github.io/master/projects/images/%EC%9D%B8%EA%B5%AC%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B8%B0%EB%B0%98%EC%86%8C%EB%93%9D%EC%98%88%EC%B8%A1%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C__91_0.png" />
</pre>

### marital.status <a class="anchor" id="section_3_3_3"></a>



```python
# ppt 시각화를 위한 코드
train.groupby('marital.status')['target'].value_counts()
```

<pre>
marital.status         target
Divorced               0         1850
                       1          236
Married-AF-spouse      0            7
                       1            5
Married-civ-spouse     0         3885
                       1         3207
Married-spouse-absent  0          183
                       1           16
Never-married          0         4582
                       1          232
Separated              0          420
                       1           34
Widowed                0          381
                       1           43
Name: target, dtype: int64
</pre>

```python
sns.set_style("whitegrid")
sns.countplot(x=train['marital.status'], hue = train['target'],palette = "muted")
plt.xticks(rotation = - 90 )
sns.set(rc = {'figure.figsize':(7,7)})
```

<pre>
<img src = "https://raw.githubusercontent.com/yangjunghyun/yangjunghyun.github.io/master/projects/images/%EC%9D%B8%EA%B5%AC%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B8%B0%EB%B0%98%EC%86%8C%EB%93%9D%EC%98%88%EC%B8%A1%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C__94_0.png" />
</pre>

### occupation <a class="anchor" id="section_3_3_4"></a>



```python
# ppt 시각화를 위한 코드
train.groupby('occupation')['target'].value_counts()
```

<pre>
occupation         target
Adm-clerical       0         1591
                   1          253
Armed-Forces       0            3
Craft-repair       0         1576
                   1          456
Exec-managerial    0         1047
                   1          992
Farming-fishing    0          438
                   1           65
Handlers-cleaners  0          639
                   1           36
Machine-op-inspct  0          876
                   1          128
Other-service      0         1527
                   1           67
Priv-house-serv    0           77
Prof-specialty     0         1088
                   1          895
Protective-serv    0          233
                   1          112
Sales              0         1280
                   1          483
Tech-support       0          322
                   1          137
Transport-moving   0          611
                   1          149
Name: target, dtype: int64
</pre>

```python
sns.set_style("whitegrid")
sns.countplot(x=train['occupation'], hue = train['target'],palette = "Paired")
plt.xticks(rotation = - 90 )
sns.set(rc = {'figure.figsize':(10,10)})
```

<pre>
<img src = "https://raw.githubusercontent.com/yangjunghyun/yangjunghyun.github.io/master/projects/images/%EC%9D%B8%EA%B5%AC%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B8%B0%EB%B0%98%EC%86%8C%EB%93%9D%EC%98%88%EC%B8%A1%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C__97_0.png" />
</pre>

### relationship <a class="anchor" id="section_3_3_5"></a>



```python
# ppt 시각화를 위한 코드
train.groupby('relationship')['target'].value_counts()
```

<pre>
relationship    target
Husband         0         3409
                1         2833
Not-in-family   0         3407
                1          429
Other-relative  0          422
                1           19
Own-child       0         2197
                1           35
Unmarried       0         1486
                1          102
Wife            0          387
                1          355
Name: target, dtype: int64
</pre>

```python
sns.set_style("whitegrid")
sns.countplot(x=train['relationship'], hue = train['target'],palette = "muted")
plt.xticks(rotation = - 90 )
sns.set(rc = {'figure.figsize':(7,7)})
```

<pre>
<img src = "https://raw.githubusercontent.com/yangjunghyun/yangjunghyun.github.io/master/projects/images/%EC%9D%B8%EA%B5%AC%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B8%B0%EB%B0%98%EC%86%8C%EB%93%9D%EC%98%88%EC%B8%A1%EA%B2%BD%EC%A7%84%EB%8C%80%ED%9A%8C__100_0.png" />
</pre>

# 모델링 <a class="anchor" id="chapter4"></a>


## 원핫인코딩 <a class="anchor" id="section_4_1"></a>



범주형 데이터를 one-hot encoding을 사용하여 범주의 개수만큼 dummy variable을 만들어 0 또는 1을 각 범주마다 할당하여 새로운 특성으로 바꾸는 방법이다.



```python
train_one = pd.get_dummies(train)
train_one.head()
```

<pre>
   id  age  education.num  sex  capital.gain  capital.loss  hours.per.week  \
0   0   32             12    1             0             0              40   
1   1   33             10    1             0             0              40   
2   2   46             10    1             0             0              40   
3   3   23             13    0             0             0              30   
4   4   55              9    0             0             0              40   

   target  workclass_Federal-gov  workclass_Local-gov  ...  \
0       0                      0                    0  ...   
1       1                      0                    0  ...   
2       0                      0                    0  ...   
3       0                      0                    0  ...   
4       0                      0                    0  ...   

   occupation_Protective-serv  occupation_Sales  occupation_Tech-support  \
0                           0                 0                        0   
1                           0                 0                        0   
2                           0                 0                        0   
3                           0                 0                        0   
4                           0                 0                        0   

   occupation_Transport-moving  relationship_Husband  \
0                            0                     1   
1                            0                     1   
2                            0                     1   
3                            0                     0   
4                            0                     0   

   relationship_Not-in-family  relationship_Other-relative  \
0                           0                            0   
1                           0                            0   
2                           0                            0   
3                           0                            0   
4                           1                            0   

   relationship_Own-child  relationship_Unmarried  relationship_Wife  
0                       0                       0                  0  
1                       0                       0                  0  
2                       0                       0                  0  
3                       1                       0                  0  
4                       0                       0                  0  

[5 rows x 42 columns]
</pre>

```python
train
```

<pre>
          id  age     workclass  education.num      marital.status  \
0          0   32       Private             12  Married-civ-spouse   
1          1   33       Private             10  Married-civ-spouse   
2          2   46       Private             10  Married-civ-spouse   
3          3   23       Private             13       Never-married   
4          4   55       Private              9            Divorced   
...      ...  ...           ...            ...                 ...   
15076  15076   35       Private             14       Never-married   
15077  15077   36       Private             10            Divorced   
15078  15078   50  Self-emp-inc             15  Married-civ-spouse   
15079  15079   39       Private             10            Divorced   
15080  15080   33       Private             12  Married-civ-spouse   

            occupation   relationship  sex  capital.gain  capital.loss  \
0         Craft-repair        Husband    1             0             0   
1      Exec-managerial        Husband    1             0             0   
2         Craft-repair        Husband    1             0             0   
3         Adm-clerical      Own-child    0             0             0   
4         Adm-clerical  Not-in-family    0             0             0   
...                ...            ...  ...           ...           ...   
15076  Exec-managerial  Not-in-family    1             0             0   
15077     Adm-clerical  Not-in-family    1             0             0   
15078   Prof-specialty        Husband    1             0             0   
15079     Tech-support  Not-in-family    0             0             0   
15080   Prof-specialty        Husband    1             0             0   

       hours.per.week  target  
0                  40       0  
1                  40       1  
2                  40       0  
3                  30       0  
4                  40       0  
...               ...     ...  
15076              40       0  
15077              45       0  
15078              45       1  
15079              40       0  
15080              50       0  

[15081 rows x 12 columns]
</pre>

```python
test_one = pd.get_dummies(test)
test_one.head()
```

<pre>
   id  age  education.num  sex  capital.gain  capital.loss  hours.per.week  \
0   0   47             10    1             0             0              45   
1   1   34             10    1             0             0              75   
2   2   31             13    1          8614             0              40   
3   3   28             13    1             0             0              55   
4   4   54             10    0             0             0              40   

   workclass_Federal-gov  workclass_Local-gov  workclass_Private  ...  \
0                      0                    0                  1  ...   
1                      0                    0                  0  ...   
2                      0                    1                  0  ...   
3                      0                    0                  1  ...   
4                      0                    1                  0  ...   

   occupation_Protective-serv  occupation_Sales  occupation_Tech-support  \
0                           0                 0                        0   
1                           0                 1                        0   
2                           0                 0                        0   
3                           0                 0                        0   
4                           0                 0                        0   

   occupation_Transport-moving  relationship_Husband  \
0                            0                     1   
1                            0                     0   
2                            0                     0   
3                            0                     1   
4                            0                     0   

   relationship_Not-in-family  relationship_Other-relative  \
0                           0                            0   
1                           1                            0   
2                           1                            0   
3                           0                            0   
4                           0                            0   

   relationship_Own-child  relationship_Unmarried  relationship_Wife  
0                       0                       0                  0  
1                       0                       0                  0  
2                       0                       0                  0  
3                       0                       0                  0  
4                       0                       1                  0  

[5 rows x 41 columns]
</pre>

```python
test
```

<pre>
          id  age     workclass  education.num      marital.status  \
0          0   47       Private             10  Married-civ-spouse   
1          1   34  Self-emp-inc             10       Never-married   
2          2   31     Local-gov             13       Never-married   
3          3   28       Private             13  Married-civ-spouse   
4          4   54     Local-gov             10             Widowed   
...      ...  ...           ...            ...                 ...   
15076  15076   30     Local-gov             10  Married-civ-spouse   
15077  15077   39       Private             13  Married-civ-spouse   
15078  15078   48       Private              7       Never-married   
15079  15079   44       Private              9  Married-civ-spouse   
15080  15080   30       Private              9       Never-married   

              occupation   relationship  sex  capital.gain  capital.loss  \
0        Exec-managerial        Husband    1             0             0   
1                  Sales  Not-in-family    1             0             0   
2           Craft-repair  Not-in-family    1          8614             0   
3         Prof-specialty        Husband    1             0             0   
4           Adm-clerical      Unmarried    0             0             0   
...                  ...            ...  ...           ...           ...   
15076    Protective-serv        Husband    1         15024             0   
15077       Craft-repair        Husband    1             0             0   
15078  Machine-op-inspct      Unmarried    1             0             0   
15079  Machine-op-inspct        Husband    1             0             0   
15080       Craft-repair  Not-in-family    1             0             0   

       hours.per.week  
0                  45  
1                  75  
2                  40  
3                  55  
4                  40  
...               ...  
15076              40  
15077              40  
15078              40  
15079              40  
15080              46  

[15081 rows x 11 columns]
</pre>
## pycaret <a class="anchor" id="section_4_2"></a>



```python
# 모델을 선정하기위한 pycaret이라는 라이브러리를 사용하였다.
from pycaret.classification import *
reg = setup(train_one, target='target')
```

<pre>
                               Description             Value
0                               session_id              4081
1                                   Target            target
2                              Target Type            Binary
3                            Label Encoded              None
4                            Original Data       (15081, 42)
5                           Missing Values             False
6                         Numeric Features                39
7                     Categorical Features                 2
8                         Ordinal Features             False
9                High Cardinality Features             False
10                 High Cardinality Method              None
11                   Transformed Train Set       (10556, 55)
12                    Transformed Test Set        (4525, 55)
13                      Shuffle Train-Test              True
14                     Stratify Train-Test             False
15                          Fold Generator   StratifiedKFold
16                             Fold Number                10
17                                CPU Jobs                -1
18                                 Use GPU             False
19                          Log Experiment             False
20                         Experiment Name  clf-default-name
21                                     USI              a9a8
22                         Imputation Type            simple
23          Iterative Imputation Iteration              None
24                         Numeric Imputer              mean
25      Iterative Imputation Numeric Model              None
26                     Categorical Imputer          constant
27  Iterative Imputation Categorical Model              None
28           Unknown Categoricals Handling    least_frequent
29                               Normalize             False
30                        Normalize Method              None
31                          Transformation             False
32                   Transformation Method              None
33                                     PCA             False
34                              PCA Method              None
35                          PCA Components              None
36                     Ignore Low Variance             False
37                     Combine Rare Levels             False
38                    Rare Level Threshold              None
39                         Numeric Binning             False
40                         Remove Outliers             False
41                      Outliers Threshold              None
42                Remove Multicollinearity             False
43             Multicollinearity Threshold              None
44             Remove Perfect Collinearity              True
45                              Clustering             False
46                    Clustering Iteration              None
47                     Polynomial Features             False
48                       Polynomial Degree              None
49                    Trignometry Features             False
50                    Polynomial Threshold              None
51                          Group Features             False
52                       Feature Selection             False
53                Feature Selection Method           classic
54            Features Selection Threshold              None
55                     Feature Interaction             False
56                           Feature Ratio             False
57                   Interaction Threshold              None
58                           Fix Imbalance             False
59                    Fix Imbalance Method             SMOTE
</pre>

```python
# Accuracy를 기준으로 좋은 모델 3개를 선정한다.
top3 = compare_models(sort = 'Accuracy',n_select = 3)
# top3 = lightgbm, gbc, ada
```

<pre>
                                    Model  Accuracy     AUC  Recall   Prec.  \
lightgbm  Light Gradient Boosting Machine    0.8644  0.9218  0.6503  0.7659   
gbc          Gradient Boosting Classifier    0.8584  0.9149  0.5842  0.7873   
ada                  Ada Boost Classifier    0.8534  0.9082  0.6118  0.7483   
lr                    Logistic Regression    0.8435  0.9009  0.5903  0.7247   
rf               Random Forest Classifier    0.8396  0.8861  0.6153  0.6989   
lda          Linear Discriminant Analysis    0.8354  0.8910  0.5576  0.7122   
ridge                    Ridge Classifier    0.8326  0.0000  0.5042  0.7339   
knn                K Neighbors Classifier    0.8309  0.8588  0.6184  0.6707   
et                 Extra Trees Classifier    0.8186  0.8432  0.5841  0.6465   
dt               Decision Tree Classifier    0.8109  0.7537  0.5999  0.6209   
nb                            Naive Bayes    0.8058  0.8889  0.7894  0.5780   
svm                   SVM - Linear Kernel    0.7873  0.0000  0.5359  0.5944   
dummy                    Dummy Classifier    0.7535  0.5000  0.0000  0.0000   
qda       Quadratic Discriminant Analysis    0.2540  0.5050  1.0000  0.2484   

              F1   Kappa     MCC  TT (Sec)  
lightgbm  0.7026  0.6157  0.6196     0.166  
gbc       0.6699  0.5824  0.5934     1.095  
ada       0.6727  0.5795  0.5847     0.325  
lr        0.6502  0.5508  0.5559     1.426  
rf        0.6541  0.5503  0.5524     1.002  
lda       0.6251  0.5217  0.5283     0.100  
ridge     0.5970  0.4961  0.5104     0.022  
knn       0.6431  0.5326  0.5336     0.513  
et        0.6134  0.4954  0.4967     1.088  
dt        0.6100  0.4853  0.4856     0.054  
nb        0.6671  0.5347  0.5478     0.024  
svm       0.5346  0.4051  0.4228     0.051  
dummy     0.0000  0.0000  0.0000     0.017  
qda       0.3979  0.0049  0.0487     0.051  
</pre>

```python
# tune_model()을 사용하여 pycaret라이브러리의 'accuracy'기준으로 상위 3개의 모델을 튜닝해준다.
tuned_top3 = [tune_model(i) for i in top3]
```

<pre>
      Accuracy     AUC  Recall   Prec.      F1   Kappa     MCC
Fold                                                          
0       0.8466  0.9005  0.6231  0.7168  0.6667  0.5677  0.5700
1       0.8580  0.9193  0.6385  0.7477  0.6888  0.5975  0.6006
2       0.8494  0.9004  0.5885  0.7463  0.6581  0.5633  0.5698
3       0.8665  0.9235  0.6192  0.7931  0.6955  0.6116  0.6193
4       0.8608  0.9204  0.6015  0.7850  0.6811  0.5941  0.6027
5       0.8608  0.9281  0.6130  0.7767  0.6852  0.5974  0.6043
6       0.8597  0.9185  0.6154  0.7692  0.6838  0.5951  0.6012
7       0.8654  0.9226  0.6308  0.7810  0.6979  0.6125  0.6183
8       0.8692  0.9151  0.5962  0.8245  0.6920  0.6116  0.6246
9       0.8635  0.9119  0.6269  0.7762  0.6936  0.6071  0.6128
Mean    0.8600  0.9160  0.6153  0.7717  0.6843  0.5958  0.6024
Std     0.0068  0.0088  0.0151  0.0279  0.0122  0.0166  0.0181
</pre>

```python
# 튜닝된 모델을 blend_model()을 활용하여 블렌딩해준다.
blender_top3 = blend_models(estimator_list=tuned_top3)
```

<pre>
      Accuracy     AUC  Recall   Prec.      F1   Kappa     MCC
Fold                                                          
0       0.8513  0.9015  0.6385  0.7249  0.6789  0.5827  0.5847
1       0.8703  0.9218  0.6577  0.7808  0.7140  0.6309  0.6348
2       0.8513  0.9025  0.5962  0.7488  0.6638  0.5699  0.5760
3       0.8665  0.9260  0.6269  0.7874  0.6981  0.6138  0.6203
4       0.8655  0.9244  0.6130  0.7960  0.6926  0.6084  0.6169
5       0.8598  0.9304  0.6169  0.7703  0.6851  0.5964  0.6025
6       0.8578  0.9201  0.6115  0.7644  0.6795  0.5896  0.5956
7       0.8635  0.9242  0.6192  0.7816  0.6910  0.6049  0.6117
8       0.8635  0.9182  0.5692  0.8222  0.6727  0.5901  0.6060
9       0.8626  0.9197  0.6231  0.7751  0.6908  0.6038  0.6098
Mean    0.8612  0.9189  0.6172  0.7752  0.6867  0.5990  0.6058
Std     0.0059  0.0091  0.0224  0.0250  0.0133  0.0163  0.0163
</pre>

```python
# 그리고 finalize_model()함수를 통해 전체 데이터로 마지막 학습을 진행한다. 이후에 predict_mdodel() 함수의 파라미터로 학습된 모델 변수, 테스트할 데이터를 각각 입력해주었다.
final_model = finalize_model(blender_top3)
prediction = predict_model(final_model, data=test_one)
```


```python
# submission 파일 제출을 위해 변수명을 변경해준다.
prediction.rename(columns = {"Label": "target"}, inplace = True)
```

## submission <a class="anchor" id="section_4_4"></a>



```python
# submission 파일에 모델링을 진행한 target값을 넣어준다.
submission['target'] = prediction['target']
```


```python
# submission파일을 내보내준다.
submission.to_csv('소득예측.csv', index = False)
```

# 결론 <a class="anchor" id="chapter5"></a>


### summary <a class="anchor" id="section_5_1"></a>

데이터 전처리 과정에서

총 4,262개의 결측치를 발견 및 제거해주었고, 교육수준 변수를 하나 제거해주었다.  



EDA 과정에서

세 개의 변수들을 제거해주었고, TARGET값이 0인 그룹과 1인 그룹으로 비교하여 시각화를 진행하였다.   

다양한 변수들이 TARGET값에 따라 많은 차이가 있다는 것을 시각화로 알 수 있었지만 

capital.gain과 capital.loss 변수에 대해서는 잘 분석하지 못한 점이 아쉬웠다.  



모델링 과정에서

모델 선택을 위해 PYCARET이라는 파이썬 라이브러리를 사용하였고, 상위 3개의 모델을 뽑아 각각 모델링도 진행해보았으나, 상위 3개 모델로 튜닝, 블렌딩 한 모델이 가장 ACCURACY값이 높았다.


### 활용가능 <a class="anchor" id="section_5_2"></a>



대회의 목적처럼 앞으로도 다양한 인구데이터를 기반으로 꽤 높은 정확도로 소득을 예측하는 것이 가능할 것 같다.


### 한계 <a class="anchor" id="section_5_3"></a>



EDA 과정에서 변수들에 대해 모든 분석 및 해석을 하지 못한 점이 아쉽다.  



모델링 과정에서는 basic 공모전인만큼 직접 모델 선정 및 모델링까지 진행해보고 싶었으나 파이썬 라이브러리인 pycaret을 이용하여 모델 선정과 모델링을 진행한 점이 아쉽다. 


### 향후계획 <a class="anchor" id="section_5_4"></a>



머신러닝에 대한 공부를 더 한 뒤에 다음 번 머신러닝 관련 공모전에서는 직접 모델 선정을 해보는 것이 목표이다. 

또, 작년 머신러닝 수업 때 조별로 진행했던 프로젝트 퀄리티만큼 스스로 해 보는 것이 목표이다.

